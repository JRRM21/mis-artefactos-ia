<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="theme-color" content="#667eea" />
  <meta name="description" content="Mis Artefactos IA — biblioteca móvil con PWA" />
  <title>📚 Mis Artefactos IA</title>
  <link rel="icon" id="favicon" type="image/svg+xml" />
  <style>
    :root{
      --bg:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
      --card:rgba(255,255,255,.96);
      --text:#1f2937;
      --muted:#6b7280;
      --border:#e5e7eb;
      --acc:#667eea;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%}
    body{
      font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Arial,sans-serif;
      background:var(--bg); color:var(--text); padding:16px;
    }
    .container{max-width:1100px;margin:0 auto}
    .header{position:relative;text-align:center;margin-bottom:18px}
    .header h1{color:#fff;font-size:2.2rem;text-shadow:0 2px 4px rgba(0,0,0,.3)}
    .header p{color:rgba(255,255,255,.95)}
    .controls{position:absolute;top:0;right:0;display:flex;gap:8px}
    .btn-icon{
      background:rgba(255,255,255,.22);border:none;border-radius:999px;
      color:#fff;font-size:1.1rem;width:38px;height:38px;cursor:pointer;
      display:grid;place-items:center;transition:.2s
    }
    .btn-icon:hover{transform:scale(1.08);background:rgba(255,255,255,.3)}
    .panel{
      background:var(--card); backdrop-filter:blur(8px); border-radius:18px;
      box-shadow:0 6px 22px rgba(0,0,0,.12); padding:16px; margin-bottom:14px
    }
    .topbar{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .search{flex:1;min-width:220px;position:relative}
    .search input{
      width:100%; padding:12px 14px 12px 38px; border:2px solid var(--border);
      border-radius:12px; font-size:0.95rem
    }
    .search .i{position:absolute;left:10px;top:50%;transform:translateY(-50%);opacity:.6}
    .filter{padding:10px;border:2px solid var(--border);border-radius:12px}
    .grid{
      display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));
      gap:14px
    }
    .app{
      background:#fff;border-radius:16px;box-shadow:0 4px 14px rgba(0,0,0,.12);
      padding:16px; text-align:center; cursor:pointer; position:relative;
      transition:.2s; display:flex;flex-direction:column;gap:6px; min-height:124px
    }
    .app:hover{transform:translateY(-3px)}
    .app .icon{font-size:2.2rem}
    .app .name{font-weight:700;font-size:.95rem;line-height:1.1}
    .app .badge{
      font-size:.7rem; color:#6b7280; background:#f3f4f6; padding:2px 8px;
      border-radius:999px; margin-top:auto
    }
    .app.placeholder{opacity:.8}
    .row{
      display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin-top:10px
    }
    .btn{
      background:linear-gradient(45deg,#667eea,#764ba2); color:#fff; border:none;
      padding:10px 14px; border-radius:12px; font-weight:700; cursor:pointer;
      display:inline-flex;align-items:center;gap:8px; text-decoration:none
    }
    .btn.secondary{background:#f8f9fa;color:#111;border:2px solid var(--border)}
    .muted{color:var(--muted);font-size:.9rem}
    .stats{
      display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:12px
    }
    .stat{
      background:var(--card);border-radius:14px;padding:14px;text-align:center;
      box-shadow:0 3px 10px rgba(0,0,0,.08)
    }
    .stat .n{font-weight:800;font-size:1.8rem;color:var(--acc)}
    .stat .l{color:var(--muted);font-size:.9rem}
    .pwa{border-top:2px solid var(--border);margin-top:10px;padding-top:10px}
    @media (max-width:768px){
      .grid{grid-template-columns:repeat(auto-fill,minmax(110px,1fr))}
      .header h1{font-size:1.8rem}
    }
    /* Dark */
    .dark body{color:#e2e8f0}
    .dark .panel,.dark .stat{background:rgba(45,55,72,.96)}
    .dark .btn.secondary{background:#2d3748;color:#e2e8f0;border-color:#4a5568}
    .dark .app{background:#2d3748;color:#e2e8f0}
    .dark .app .badge{background:#374151;color:#cbd5e0}
    .toast{
      position:fixed;top:18px;right:18px;background:#111;color:#fff;padding:10px 14px;
      border-radius:10px;box-shadow:0 6px 18px rgba(0,0,0,.25);z-index:2000;opacity:0;transform:translateY(-10px);
      transition:.25s
    }
    .toast.show{opacity:1;transform:translateY(0)}
  </style>
</head>
<body>
  <div class="container">
    <header class="header">
      <div class="controls">
        <button class="btn-icon" id="themeBtn" title="Tema">🌙</button>
        <button class="btn-icon" id="fullBtn" title="Pantalla completa">⛶</button>
      </div>
      <h1>📚 Mis Artefactos IA</h1>
      <p>Tu biblioteca móvil de proyectos (PWA, offline, acceso rápido)</p>
    </header>

    <!-- BARRA SUPERIOR -->
    <div class="panel topbar">
      <div class="search">
        <span class="i">🔎</span>
        <input id="q" placeholder="Buscar por nombre, tipo o etiqueta…" />
      </div>
      <select id="type" class="filter">
        <option value="">Todos los tipos</option>
        <option value="web">🌐 Web</option>
        <option value="app">📱 App</option>
        <option value="juego">🎮 Juego</option>
        <option value="herramienta">🔧 Herramienta</option>
        <option value="arte">🎨 Arte</option>
        <option value="otro">📄 Otro</option>
      </select>
      <select id="sort" class="filter">
        <option value="newest">🕐 Más recientes</option>
        <option value="name">🔤 Alfabético</option>
        <option value="type">📂 Por tipo</option>
      </select>
      <button class="btn secondary" id="exportBtn">📤 Exportar</button>
      <button class="btn" id="installBtn" style="display:none">⬇️ Instalar App</button>
    </div>

    <!-- CUADRÍCULA -->
    <div class="panel">
      <div class="grid" id="grid"></div>
      <div class="row">
        <span class="muted" id="count">0 artefactos</span>
        <span class="muted">•</span>
        <span class="muted">💡 Consejo: pulsa “⬇️ Instalar App” para tener acceso en tu pantalla de inicio.</span>
      </div>
    </div>

    <!-- STATS -->
    <div class="stats">
      <div class="stat">
        <div class="n" id="sTotal">0</div>
        <div class="l">Total artefactos</div>
      </div>
      <div class="stat">
        <div class="n" id="sTipos">0</div>
        <div class="l">Tipos distintos</div>
      </div>
      <div class="stat">
        <div class="n" id="sMes">0</div>
        <div class="l">Añadidos este mes</div>
      </div>
    </div>

    <!-- PWA -->
    <div class="panel pwa">
      <h3>📱 Instalar como App</h3>
      <p class="muted">Android: menú “⋮” → “Instalar app”. &nbsp; iOS (Safari): “Compartir” → “Añadir a pantalla de inicio”.</p>
    </div>
  </div>

  <div class="toast" id="toast"></div>

  <script>
    // ========= ICONOS APP =========
    const appIcons = {
      favicon: `data:image/svg+xml,${encodeURIComponent(`
        <svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'>
          <defs><linearGradient id='g' x1='0' y1='0' x2='1' y2='1'><stop offset='0' stop-color='#667eea'/><stop offset='1' stop-color='#764ba2'/></linearGradient></defs>
          <rect rx='8' width='32' height='32' fill='url(#g)'/>
          <text x='16' y='21' text-anchor='middle' fill='#fff' font-size='14' font-weight='700' font-family='Arial, sans-serif'>IA</text>
        </svg>
      `)}`,
      icon192: `data:image/svg+xml,${encodeURIComponent(`
        <svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 192 192'>
          <defs><linearGradient id='g192' x1='0' y1='0' x2='1' y2='1'><stop offset='0' stop-color='#667eea'/><stop offset='1' stop-color='#764ba2'/></linearGradient></defs>
          <rect rx='36' width='192' height='192' fill='url(#g192)'/>
          <text x='96' y='116' text-anchor='middle' fill='#fff' font-size='86' font-weight='800' font-family='Arial, sans-serif'>IA</text>
        </svg>
      `)}`,
      icon512: `data:image/svg+xml,${encodeURIComponent(`
        <svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'>
          <defs><linearGradient id='g512' x1='0' y1='0' x2='1' y2='1'><stop offset='0' stop-color='#667eea'/><stop offset='1' stop-color='#764ba2'/></linearGradient></defs>
          <rect rx='88' width='512' height='512' fill='url(#g512)'/>
          <text x='256' y='320' text-anchor='middle' fill='#fff' font-size='240' font-weight='900' font-family='Arial, sans-serif'>IA</text>
        </svg>
      `)}`
    };
    document.getElementById('favicon').href = appIcons.favicon;

    // ========= PON AQUÍ TUS URLS REALES (TODO) =========
    const URLS = {
      // Rellena con tus dominios de Vercel o donde estén hospedados
      cuadernoAzul: "",          // p.ej: "https://cuaderno-azul.vercel.app"
      relojCibernetico: "",      // p.ej: "https://reloj-cibernetico.vercel.app"
      tuVozConAlma: ""           // p.ej: "https://tu-voz-con-alma.vercel.app"
    };

    // ========= CATÁLOGO: 3 reales + 5 placeholders =========
    let projects = [
      // Reales (usa los nombres tal como saldrán en la app)
      { id: 1, name: "📘 Cuaderno Azul",         type: "herramienta", icon: "📘", url: URLS.cuadernoAzul, tags:["notas","texto"], createdAt: new Date().toISOString() },
      { id: 2, name: "⏰ Reloj Cibernético",     type: "herramienta", icon: "⏰", url: URLS.relojCibernetico, tags:["tiempo","timer"], createdAt: new Date().toISOString() },
      { id: 3, name: "🎙️ Tu Voz con Alma",     type: "arte",        icon: "🎙️", url: URLS.tuVozConAlma, tags:["audio","voz"], createdAt: new Date().toISOString() },

      // Placeholders (sin URL por ahora)
      { id: 4, name: "🔵 Botón Azul (Memoria Externa)", type: "herramienta", icon: "🔵", url: "", tags:["memoria"], createdAt: new Date().toISOString() },
      { id: 5, name: "🧓 Help Senior Citizens",        type: "app",        icon: "🧓", url: "", tags:["salud","ayuda"], createdAt: new Date().toISOString() },
      { id: 6, name: "📘 Cuaderno Azul Digital",       type: "herramienta", icon: "📘", url: "", tags:["notas"], createdAt: new Date().toISOString() },
      { id: 7, name: "🎵 IA Música con Alma",          type: "arte",        icon: "🎵", url: "", tags:["música","audio"], createdAt: new Date().toISOString() },
      { id: 8, name: "🟠 Botón Naranja (1os Auxilios)",type: "herramienta", icon: "🟠", url: "", tags:["emergencia"], createdAt: new Date().toISOString() },
    ];

    // ========= ESTADO/UI =========
    const el = {
      grid:  document.getElementById('grid'),
      q:     document.getElementById('q'),
      type:  document.getElementById('type'),
      sort:  document.getElementById('sort'),
      count: document.getElementById('count'),
      sTotal:document.getElementById('sTotal'),
      sTipos:document.getElementById('sTipos'),
      sMes:  document.getElementById('sMes'),
      exportBtn:document.getElementById('exportBtn'),
      installBtn:document.getElementById('installBtn'),
      toast: document.getElementById('toast'),
      themeBtn:document.getElementById('themeBtn'),
      fullBtn: document.getElementById('fullBtn')
    };

    // Persistencia simple
    const saved = localStorage.getItem('aiProjects');
    if(saved){
      try{
        const parsed = JSON.parse(saved);
        if(Array.isArray(parsed) && parsed.length) projects = parsed;
      }catch{}
    }
    save();

    // Render inicial
    render();
    stats();

    // Búsqueda/filtros/orden
    el.q.addEventListener('input', render);
    el.type.addEventListener('change', render);
    el.sort.addEventListener('change', render);

    // Exportar
    el.exportBtn.addEventListener('click', () => {
      const blob = new Blob([JSON.stringify(projects,null,2)], {type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = `mis-artefactos-ia_${ts()}.json`; a.click();
      URL.revokeObjectURL(url);
      toast('💾 Exportado');
    });

    // Tema
    let dark = localStorage.getItem('darkMode') === 'true';
    applyTheme();
    el.themeBtn.addEventListener('click', () => {
      dark = !dark; localStorage.setItem('darkMode', dark); applyTheme();
      toast(dark?'🌙 Tema oscuro':'☀️ Tema claro');
    });

    function applyTheme(){
      document.body.classList.toggle('dark', dark);
      el.themeBtn.textContent = dark ? '☀️' : '🌙';
    }

    // Fullscreen
    el.fullBtn.addEventListener('click', () => {
      if(!document.fullscreenElement){ document.documentElement.requestFullscreen(); toast('⛶ Pantalla completa'); }
      else { document.exitFullscreen(); toast('↩️ Salir pantalla completa'); }
    });

    // Helpers
    function ts(d=new Date()){
      const p=n=>String(n).padStart(2,'0');
      return `${d.getFullYear()}${p(d.getMonth()+1)}${p(d.getDate())}_${p(d.getHours())}${p(d.getMinutes())}`;
    }
    function save(){ localStorage.setItem('aiProjects', JSON.stringify(projects)); }
    function typeLabel(t){ return ({web:'Web',app:'App',juego:'Juego',herramienta:'Herramienta',arte:'Arte',otro:'Otro'})[t]||'Otro'; }
    function formatDate(s){
      const d=new Date(s), n=new Date();
      if(d.toDateString()===n.toDateString()) return 'Hoy';
      return d.toLocaleDateString('es-ES',{year:'numeric',month:'short',day:'numeric'});
    }
    function toast(msg,dur=2000){
      el.toast.textContent = msg;
      el.toast.classList.add('show');
      setTimeout(()=>el.toast.classList.remove('show'), dur);
    }

    // Render principal
    function render(){
      const term = el.q.value.trim().toLowerCase();
      const t = el.type.value;
      let list = projects.slice();

      // Filtro
      if(term){
        list = list.filter(p =>
          p.name.toLowerCase().includes(term) ||
          p.tags?.some(tag => tag.toLowerCase().includes(term)) ||
          p.type.toLowerCase().includes(term)
        );
      }
      if(t) list = list.filter(p => p.type===t);

      // Orden
      const s = el.sort.value;
      if(s==='name') list.sort((a,b)=>a.name.localeCompare(b.name,'es'));
      else if(s==='type') list.sort((a,b)=>a.type.localeCompare(b.type,'es')||a.name.localeCompare(b.name,'es'));
      else list.sort((a,b)=>new Date(b.createdAt)-new Date(a.createdAt));

      // Pintar
      el.grid.innerHTML = list.map(p => card(p)).join('');
      el.count.textContent = `${list.length} artefacto${list.length!==1?'s':''}`;
    }

    function card(p){
      const isPlaceholder = !p.url;
      const attr = p.url ? `href="${escapeAttr(p.url)}" target="_blank" rel="noopener noreferrer"` : '';
      const tag = p.url ? 'a' : 'div';
      const cls = `app ${isPlaceholder?'placeholder':''}`;
      const warn = isPlaceholder ? `<div class="muted" style="font-size:.75rem">• sin URL aún</div>` : '';
      return `
        <${tag} ${attr} class="${cls}" data-id="${p.id}">
          <div class="icon">${escapeHtml(p.icon||'📦')}</div>
          <div class="name">${escapeHtml(p.name)}</div>
          <div class="badge">${escapeHtml(typeLabel(p.type))}</div>
          ${warn}
        </${tag}>
      `;
    }

    function escapeHtml(str=''){return String(str).replace(/[&<>"']/g, s=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;' }[s]));}
    function escapeAttr(str=''){return String(str).replace(/["']/g, s=>({ '"':'&quot;','\'':'&#39;' }[s]));}

    // Stats
    function stats(){
      document.getElementById('sTotal').textContent = projects.length;
      document.getElementById('sTipos').textContent = new Set(projects.map(p=>p.type)).size;
      const now = new Date();
      const thisMonth = projects.filter(p=>{
        const d=new Date(p.createdAt);
        return d.getMonth()===now.getMonth() && d.getFullYear()===now.getFullYear();
      }).length;
      document.getElementById('sMes').textContent = thisMonth;
    }

    // ========= PWA: manifest + service worker =========
    // Manifest
    const manifest = {
      name: "Mis Artefactos IA",
      short_name: "Artefactos IA",
      description: "Tu biblioteca móvil de artefactos IA",
      start_url: ".",
      display: "standalone",
      theme_color: "#667eea",
      background_color: "#667eea",
      icons: [
        { src: appIcons.icon192, sizes:"192x192", type:"image/svg+xml" },
        { src: appIcons.icon512, sizes:"512x512", type:"image/svg+xml" }
      ]
    };
    const manifestBlob = new Blob([JSON.stringify(manifest)], {type:'application/json'});
    const manifestUrl = URL.createObjectURL(manifestBlob);
    const linkManifest = document.createElement('link');
    linkManifest.rel = 'manifest'; linkManifest.href = manifestUrl;
    document.head.appendChild(linkManifest);

    // Service Worker (cache básico)
    const swCode = `
      const CACHE = 'artefactos-ia-v1';
      const ASSETS = ['./'];
      self.addEventListener('install', e=>{
        e.waitUntil(caches.open(CACHE).then(c=>c.addAll(ASSETS)));
      });
      self.addEventListener('activate', e=>{
        e.waitUntil(caches.keys().then(keys=>Promise.all(keys.map(k=>k!==CACHE && caches.delete(k)))));
      });
      self.addEventListener('fetch', e=>{
        e.respondWith(fetch(e.request).catch(()=>caches.match(e.request)));
      });
    `;
    const swBlob = new Blob([swCode], {type:'text/javascript'});
    const swUrl = URL.createObjectURL(swBlob);

    if('serviceWorker' in navigator){
      navigator.serviceWorker.register(swUrl).catch(()=>{});
    }

    // Instalar como app (Android/Chrome)
    let deferredPrompt=null;
    window.addEventListener('beforeinstallprompt', (e)=>{
      e.preventDefault();
      deferredPrompt = e;
      el.installBtn.style.display='inline-flex';
    });
    el.installBtn.addEventListener('click', async ()=>{
      if(!deferredPrompt) return;
      deferredPrompt.prompt();
      const { outcome } = await deferredPrompt.userChoice;
      if(outcome==='accepted') toast('✅ App instalada'); else toast('ℹ️ Instalación cancelada');
      deferredPrompt=null; el.installBtn.style.display='none';
    });

    // ========= PRIMERA EJECUCIÓN: si añades URLs luego, solo recarga =========
    // Guarda cualquier cambio manual que hagas en projects:
    window.addEventListener('beforeunload', save);
  </script>
</body>
</html>
